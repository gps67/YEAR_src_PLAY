#!/tools/CTXT/tcl/bin/tclsh

lappend auto_path [pwd]/fns_tcl

if 1 {
	# test say_do
	say_do pwd
	say_do ls
	say_do {bash -c "pwd;exit 7"}
	say_do false
	# say_do {vi /tmp/t}
}


proc OUT {str} {
	global CA_out
	puts $CA_out $str
	puts         $str
}

proc FMT {fmt args} {
#	puts "# fmt # $fmt"
#	puts "# args # $args"
	;# args is special spelling
	;# it receives tail args as a list
	global CA_out
	set argv [linsert $args 0 format $fmt]
# 	set argv [concat format $fmt $args]
#	this left the [] unprotected unquoted
#	puts "# argv # $argv"
	OUT [ eval $argv ]
}

proc name_eq_value { name value } {
	FMT "%-15s = %s" $name $value
}

proc main_mk_CA_conf {} {
 	set CA_conf_filename CA.conf.next
	global CA_out
	;# beware 0644 needs leading 0 to be octal not decimal
	set CA_out [open $CA_conf_filename w+ 0644] ;# truncate if exists

	FMT {[%s]} ca
	name_eq_value default_ca CA_default

	FMT {[%s]} CA_default
	name_eq_value	dir /root/ca/root-ca
	name_eq_value	certs     \$dir/certs
	name_eq_value	crl_dir   \$dir/crl
}

main_mk_CA_conf 
